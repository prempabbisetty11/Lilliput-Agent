<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lilliput Agent â€” AI Workspace</title>
  <meta name="description" content="Lilliput Agent is a modern AI workspace with chat and voice features." />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="theme-dark">
  <div class="single-chat-app">
    <header class="topbar">
      <div class="topbar-left">
        <h1>Lilliput Chat</h1>
        <span class="workspace-tag">Lilliput Agent</span>
      </div>
      <div class="topbar-right">
        <button class="icon-btn" id="themeToggle" title="Toggle theme">ðŸŒ—</button>
      </div>
    </header>

    <main class="single-workspace">
      <div class="chat-panel">
        <div class="chat-header">
          <div class="chat-title">
            <strong>New Conversation</strong>
            <span class="status">Online</span>
          </div>
        </div>

        <!-- Messages -->
        <div id="chat" class="chat-body chat-stream">
          <!-- Messages injected by script.js -->
        </div>

        <!-- Composer -->
        <div class="chat-composer">
          <div class="input-wrap">
            <input
              id="msg"
              type="text"
              placeholder="Type your messageâ€¦"
              autocomplete="off"
            />
          </div>
          <div class="composer-actions">
            <button class="btn secondary" id="voiceBtn" onclick="startVoice()" title="Speak">ðŸŽ¤</button>
            <button class="btn secondary" id="muteBtn" onclick="toggleMute()" title="Mute / Unmute">ðŸ”Š</button>
            <button class="btn primary" id="sendBtn" onclick="send()">Send</button>
          </div>
        </div>
      </div>
    </main>

    <footer class="app-footer">
      <span>Â© 2026 Prem Pabbisetty</span>
    </footer>
  </div>

  <!-- App Script -->
  <script src="script.js"></script>
  <script>
    // --- Simple Chat History (localStorage) ---
    const CHAT_KEY = "lilliput_chat_history_v1";
    const chatEl = document.getElementById("chat");

    // Restore history on load
    document.addEventListener("DOMContentLoaded", () => {
      try {
        const saved = localStorage.getItem(CHAT_KEY);
        if (saved && chatEl) {
          chatEl.innerHTML = saved;
          // Scroll to bottom after restore
          chatEl.scrollTop = chatEl.scrollHeight;
        }
      } catch (e) {
        console.warn("Could not restore chat history", e);
      }
    });

    // Observe changes to chat and persist
    if (chatEl) {
      const observer = new MutationObserver(() => {
        try {
          localStorage.setItem(CHAT_KEY, chatEl.innerHTML);
        } catch (e) {
          console.warn("Could not save chat history", e);
        }
      });

      observer.observe(chatEl, { childList: true, subtree: true, characterData: true });
    }
  </script>
</body>
</html>